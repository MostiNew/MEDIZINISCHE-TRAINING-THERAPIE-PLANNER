<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MTT-Therapieplan (KOS)</title>

<style>
body{
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  background:#f4f6f8;
  margin:0;
  padding:10px;
  font-size:14px;
}
h1{font-size:1.4rem}
.card{
  background:#fff;
  border-radius:12px;
  padding:12px;
  margin-bottom:14px;
  box-shadow:0 4px 10px rgba(0,0,0,.06);
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:.75rem;
}
th,td{
  padding:6px;
  border-bottom:1px solid #e5e7eb;
  text-align:center;
}
th{
  background:#0369a1;
  color:white;
}
select,input{
  width:100%;
  padding:4px;
  border-radius:6px;
  border:1px solid #cbd5e1;
  font-size:.75rem;
}
@media(max-width:900px){
  table{font-size:.65rem}
}
button{
  background:#0369a1;
  color:white;
  border:none;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
}
.actions{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px}
@media print{.actions{display:none}}
</style>
</head>

<body>

<h1>MTT-Therapieplan (druck- & KOS-f√§hig)</h1>

<div class="actions">
  <button onclick="window.print()">üñ®Ô∏è Drucken / PDF</button>
  <button onclick="exportCSV()">‚¨áÔ∏è KOS CSV</button>
  <button onclick="exportJSON()">‚¨áÔ∏è KOS JSON</button>
</div>

<div class="card">
<table id="mtt">
<tr>
<th>‚úî</th>
<th>Nr</th>
<th>√úbungsart</th>
<th>Ger√§t</th>
<th>Belastung</th>
<th>Watt</th>
<th>kg</th>
<th>S√§tze</th>
<th>Wdh</th>
<th>UPM</th>
<th>ICF-Ziel</th>
</tr>
</table>
</div>

<script>
// =====================
// 70 GER√ÑTE
// =====================
const geraete = [
"Laufband","Fahrradergometer","Arm-Ergometer","Ellipsentrainer","Stepper",
"Ruderergometer","Sitzergometer","Oberk√∂rper-Ergometer","Seilzug Doppelturm",
"Latzug","Ruderzug","Butterfly","Chest Press","Shoulder Press",
"Beinpresse 45¬∞","Beinstrecker","Beinbeuger","Abduktor","Adduktor",
"Gluteusmaschine","Wadenpresse","H√ºftstrecker","H√ºftbeuger",
"Rumpfstrecker","Rumpfbeuger","Rotationstrainer","Lateralflexion Rumpf",
"Wirbels√§ulenmobilisation","Nackenextension","Nackenflexion",
"Schulterabduktion","Schulteradduktion","Schulterrotation innen",
"Schulterrotation au√üen","Bizepsmaschine","Trizepsmaschine",
"Unterarmtrainer","Handkrafttrainer","Greiftrainer",
"Balance Board","Wackelbrett","Propriozeptionsplatte",
"Thera-Band Station","Sprossenwand","Matten√ºbungen",
"Kabelzug funktionell","Zirkelstation Beine","Zirkelstation Arme",
"Zirkelstation Rumpf","Zirkelstation Ganzk√∂rper",
"Kniebeugenmaschine","Ausfallschritt-Trainer","Core-Trainer",
"Schlingentrainer","Reaktionswand","Gangtrainer","Treppentrainer",
"Stehtrainer","Rollstuhltrainer","Arm-Bein-Kombitrainer"
];

// =====================
// ICF ZUORDNUNG
// =====================
const icfMap = {
"Ausdauer":"b455 ‚Äì Belastbarkeit",
"Kraft":"b730 ‚Äì Muskelkraft",
"Stabilisation":"b760 ‚Äì Kontrolle",
"Mobilit√§t":"b710 ‚Äì Beweglichkeit"
};

// =====================
// BELASTUNGSSTUFEN
// =====================
const belastungPreset = {
"leicht":{kg:10,watt:50,wdh:15,satz:2,upm:50},
"mittel":{kg:20,watt:80,wdh:12,satz:3,upm:60},
"schwer":{kg:30,watt:120,wdh:10,satz:4,upm:70}
};

function optionList(arr){
  return arr.map(v=>`<option>${v}</option>`).join("");
}

const table = document.getElementById("mtt");

// =====================
// 70 ZEILEN
// =====================
for(let i=1;i<=70;i++){
  const r = table.insertRow();
  r.innerHTML = `
  <td><input type="checkbox"></td>
  <td>${i}</td>
  <td>
    <select onchange="updateICF(this)">
      <option></option>
      <option>Ausdauer</option>
      <option>Kraft</option>
      <option>Stabilisation</option>
      <option>Mobilit√§t</option>
    </select>
  </td>
  <td>
    <select>${optionList(geraete)}</select>
  </td>
  <td>
    <select onchange="applyLoad(this)">
      <option></option>
      <option>leicht</option>
      <option>mittel</option>
      <option>schwer</option>
    </select>
  </td>
  <td><input></td>
  <td><input></td>
  <td><input></td>
  <td><input></td>
  <td><input></td>
  <td><input></td>
  `;
}

// =====================
// AUTO FUNKTIONEN
// =====================
function applyLoad(sel){
  const row = sel.closest("tr");
  const p = belastungPreset[sel.value];
  if(!p) return;
  row.cells[5].querySelector("input").value = p.watt;
  row.cells[6].querySelector("input").value = p.kg;
  row.cells[7].querySelector("input").value = p.satz;
  row.cells[8].querySelector("input").value = p.wdh;
  row.cells[9].querySelector("input").value = p.upm;
}

function updateICF(sel){
  const row = sel.closest("tr");
  row.cells[10].querySelector("input").value = icfMap[sel.value] || "";
}

// =====================
// EXPORTS
// =====================
function exportCSV(){
  let csv="";
  [...table.rows].forEach(r=>{
    const vals=[...r.querySelectorAll("input,select")].map(e=>e.value);
    if(vals.join("").trim()) csv+=vals.join(";")+"\n";
  });
  download(csv,"mtt_kos.csv","text/csv");
}

function exportJSON(){
  let data=[];
  [...table.rows].forEach(r=>{
    const f=[...r.querySelectorAll("input,select")].map(e=>e.value);
    if(f.join("").trim())
      data.push({nr:f[1],art:f[2],geraet:f[3],belastung:f[4],
        watt:f[5],kg:f[6],saetze:f[7],wdh:f[8],upm:f[9],icf:f[10]});
  });
  download(JSON.stringify(data,null,2),"mtt_kos.json","application/json");
}

function download(data,name,type){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([data],{type}));
  a.download=name;
  a.click();
}
</script>

</body>
</html>
