<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MTT-Planer ‚Äì Therapieplan</title>

<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:#f5f7fa;margin:0;padding:12px;color:#1f2937}
h1,h2{margin:0 0 8px}
.container{max-width:100%;margin:auto}
.card{background:#fff;border-radius:10px;padding:12px;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,.08)}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:8px}
select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #cbd5e1;font-size:.8rem}
textarea{resize:vertical}
.actions{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
button{flex:1;padding:10px;border-radius:10px;border:none;background:#0284c7;color:#fff;font-size:.85rem}
button.secondary{background:#334155}
.admin{border-left:4px solid #ca8a04}
.prescribe{border-left:4px solid #0284c7}
.execute{border-left:4px solid #16a34a}
.evaluate{border-left:4px solid #ea580c}
.table-wrap{overflow-x:auto}
table{min-width:900px;width:100%;border-collapse:collapse;font-size:.75rem}
th{background:#0284c7;color:#fff;padding:6px;white-space:nowrap}
td{border-bottom:1px solid #e2e8f0;padding:6px;text-align:center}
tr:hover td{background:#e0f2fe}
footer{text-align:center;font-size:.7rem;color:#6b7280;margin-top:16px}
@media print{.actions{display:none}}
</style>
</head>

<body>
<div class="container">

<h1>MTT-Planer</h1>
<div style="font-size:.7rem;color:#475569;margin-bottom:10px">
Lokal ¬∑ Mobilf√§hig ¬∑ Keine Cloud ¬∑ ¬© Ali Moustafa
</div>

<div class="actions">
  <button onclick="window.print()">üñ®Ô∏è Drucken</button>
  <button class="secondary" onclick="exportCSV()">CSV</button>
  <button class="secondary" onclick="exportJSON()">JSON</button>
  <button class="secondary" onclick="exportFHIR()">FHIR</button>
</div>

<!-- ADMIN -->
<div class="card admin">
<h2>A. Patient & Organisation</h2>
<div class="grid admin-fields">
  <select><option>Patienten-ID</option></select>
  <select><option>Name, Vorname</option></select>
  <select><option>Geburtsdatum</option></select>
  <select><option>Fallnummer / KOS-ID</option></select>
  <select><option>Station</option></select>
  <select><option>Raum / MTT</option></select>
  <select><option>Arzt</option></select>
  <select><option>Therapeut</option></select>
  <select><option>Datum</option></select>
</div>
</div>

<!-- PRESCRIBE -->
<div class="card prescribe">
<h2>B. Therapieplanung</h2>
<div class="grid prescribe-fields">
  <select><option>Diagnose / Befund</option></select>
  <select><option>Therapieziele (ICF)</option></select>
  <select><option>K√∂rperregion</option></select>
  <select><option>Akut</option><option>Aufbau</option><option>Funktionell</option><option>Return-to-Activity</option></select>
  <select><option>ROM min</option></select>
  <select><option>ROM max</option></select>
  <select><option>Schmerz (NRS)</option></select>
  <select><option>submaximal</option><option>progressiv</option><option>isometrisch</option><option>exzentrisch</option></select>
  <select><option>Tempo / UPM</option></select>
  <select><option>Pause (s)</option></select>
</div>
</div>

<!-- EXERCISES -->
<div class="card execute">
<h2>C. Ger√§te & √úbungen</h2>
<div class="table-wrap">
<table id="exerciseTable">
<tr>
<th>‚úî</th><th>Nr</th><th>Art</th><th>Ger√§t</th>
<th>Watt</th><th>kg</th><th>S√§tze</th><th>Wdh</th>
<th>UPM</th><th>ROM</th><th>Pause</th><th>Kommentar</th>
</tr>
</table>
</div>
</div>

<!-- EVALUATION -->
<div class="card evaluate">
<h2>D. Evaluation</h2>
<div class="grid">
  <select><option>ROM erreicht</option><option>teilweise</option><option>nein</option></select>
  <select><option>Schmerz (NRS)</option></select>
  <select><option>Belastung gut</option><option>reduziert</option><option>nicht toleriert</option></select>
  <select><option>Kommentar</option></select>
</div>
</div>

<footer>MTT-Planer ¬∑ Mobile ¬∑ GitHub Pages</footer>
</div>

<script>
// Presets
const presets={
  Kraft:{S:"3",W:"10",P:"60"},
  Ausdauer:{S:"1",W:"-",P:"0"},
  Mobilit√§t:{S:"2",W:"12",P:"30"},
  Stabilisation:{S:"2",W:"12",P:"30"}
};

// Ger√§te Liste 70 Standardger√§te
const geraeteListe = [
"Laufband","Fahrradergometer","Arm-Ergometer (Handkurbel)","Ellipsentrainer","Stepper","Ruderergometer","Sitzergometer","Oberk√∂rper-Ergometer",
"Seilzug Doppelturm","Seilzug Einfach","Latzugmaschine","Ruderzugmaschine","Butterfly / Reverse","Chest Press","Shoulder Press","Beinpresse 45¬∞",
"Horizontale Beinpresse","Beinstrecker","Beinbeuger","Abduktor","Adduktor","Gluteusmaschine","Wadenpresse","H√ºftstrecker","H√ºftbeuger","Rumpfstrecker",
"Rumpfbeuger","Rotationstrainer Rumpf","Lateralflexion Rumpf","Wirbels√§ulenmobilisation","Nackenextension","Nackenflexion","Schulterabduktion",
"Schulteradduktion","Schulterrotation innen","Schulterrotation au√üen","Bizepsmaschine","Trizepsmaschine","Unterarmtrainer","Handkrafttrainer",
"Greiftrainer","Koordinationsleiter","Balance Board","Propriozeptionsplatte","Wackelbrett","Thera-Band Station","Sprossenwand","Matten√ºbungsplatz",
"Kabelzug funktionell","Zirkelstation 1 ‚Äì Beine","Zirkelstation 2 ‚Äì Arme","Zirkelstation 3 ‚Äì Rumpf","Zirkelstation 4 ‚Äì Ganzk√∂rper","Kniebeugenmaschine",
"Ausfallschritt-Trainer","Core-Trainer","Schlingentrainer","Reaktionswand","Koordinationsboard","Gangtrainer","Treppentrainer","Stehtrainer",
"Rollstuhltrainer","Arm-/Bein-Kombitrainer"
];

function geraeteOptions(){ return geraeteListe.map(g=>`<option>${g}</option>`).join(""); }

// Build table
const table=document.getElementById("exerciseTable");
for(let n=1;n<=70;n++){
  const r=table.insertRow();
  r.innerHTML = `
  <td><input type="checkbox"></td>
  <td>${n}</td>
  <td>
    <select onchange="applyPreset(this)">
      <option></option>
      <option>Kraft</option>
      <option>Ausdauer</option>
      <option>Mobilit√§t</option>
      <option>Stabilisation</option>
    </select>
  </td>
  <td>
    <select><option value="">Ger√§t ausw√§hlen</option>${geraeteOptions()}</select>
  </td>
  <td><select><option>Watt</option></select></td>
  <td><select><option>kg</option></select></td>
  <td><select><option>S√§tze</option></select></td>
  <td><select><option>Wdh</option></select></td>
  <td><select><option>UPM</option></select></td>
  <td><select><option>ROM</option></select></td>
  <td><select><option>Pause</option></select></td>
  <td><select><option>Kommentar</option></select></td>`;
}

// Preset apply
function applyPreset(sel){
  const p=presets[sel.value]; if(!p)return;
  const s=sel.closest("tr").querySelectorAll("select");
  s[6].value=p.S;
  s[7].value=p.W;
  s[10].value=p.P;
}

// Exports
function download(data,name,type){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([data],{type}));
  a.download=name; a.click();
}

function exportCSV(){
  let out="Nr;Art;Ger√§t;Watt;kg;S√§tze;Wdh;UPM;ROM;Pause;Kommentar\n";
  [...table.rows].slice(1).forEach(r=>{
    const v=[...r.querySelectorAll("select,input")].map(i=>i.value);
    if(v.join("").trim()) out+=`${r.cells[1].innerText};${v.slice(1).join(";")}\n`;
  });
  download(out,"MTT_KOS.csv","text/csv");
}

function exportJSON(){
  const json={
    system:"MTT-Planer",
    created:new Date().toISOString(),
    exercises:[...table.rows].slice(1).map(r=>{
      const i=r.querySelectorAll("select,input");
      return{nr:r.cells[1].innerText,art:i[1].value,geraet:i[2].value};
    }).filter(e=>Object.values(e).join("").trim())
  };
  download(JSON.stringify(json,null,2),"MTT_KOS.json","application/json");
}

function exportFHIR(){
  const Bundle={resourceType:"Bundle",type:"collection",timestamp:new Date().toISOString(),entry:[]};
  [...table.rows].slice(1).forEach(r=>{
    const i=r.querySelectorAll("select,input");
    if(![...i].some(v=>v.value)) return;
    Bundle.entry.push({resource:{resourceType:"CarePlan",activity:[{detail:{description:i[2].value+" - "+i[3].value}}]}});
  });
  download(JSON.stringify(Bundle,null,2),"MTT_FHIR_Bundle.json","application/fhir+json");
}
</script>

</body>
</html>
