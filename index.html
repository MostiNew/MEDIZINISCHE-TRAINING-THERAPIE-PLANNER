<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MTT-Planer ‚Äì Klinikversion</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  background:#f5f7fa;margin:0;padding:12px;color:#1f2937
}
h1,h2{margin:0 0 8px}
.container{max-width:1100px;margin:auto}
.card{
  background:#fff;border-radius:10px;padding:12px;margin-bottom:12px;
  box-shadow:0 2px 8px rgba(0,0,0,.08)
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:8px
}
input,select,textarea{
  width:100%;padding:8px;border-radius:6px;
  border:1px solid #cbd5e1;font-size:.8rem
}
textarea{resize:vertical}
.actions{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
button{
  padding:10px;border-radius:8px;border:none;
  background:#0284c7;color:#fff;font-size:.85rem;cursor:pointer
}
button.secondary{background:#334155}
button.warn{background:#dc2626}

.admin{border-left:4px solid #ca8a04}
.plan{border-left:4px solid #0284c7}
.exec{border-left:4px solid #16a34a}
.eval{border-left:4px solid #ea580c}

.table-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:.75rem;min-width:1100px}
th{background:#0284c7;color:#fff;padding:6px;white-space:nowrap}
td{border-bottom:1px solid #e2e8f0;padding:6px;text-align:center}

.print-value{display:none;font-size:12px;white-space:pre-wrap}

@media print{
  .actions,button{display:none}
  input,select,textarea{display:none}
  .print-value{display:inline}
  #exerciseTable tr{display:none}
  #exerciseTable tr.printable{display:table-row}
}

footer{text-align:center;font-size:.7rem;color:#6b7280;margin-top:16px}
</style>
</head>

<body>
<div class="container">

<h1>MTT-Therapieplan</h1>
<div style="font-size:.75rem;color:#475569;margin-bottom:10px">
Offline ¬∑ Druckf√§hig ¬∑ Patientenspezifisch
</div>

<div class="actions">
  <button onclick="savePatient()">üíæ Speichern</button>
  <button class="secondary" onclick="loadPatient()">üìÇ Laden</button>
  <button class="warn" onclick="deletePatient()">üóëÔ∏è L√∂schen</button>
  <button onclick="quickPrint()">üñ®Ô∏è Patient-PDF</button>
</div>

<!-- A -->
<div class="card admin">
<h2>A. Patient & Organisation</h2>
<div class="grid">
  <input id="pid" placeholder="Patienten-ID">
  <input id="name" placeholder="Name">
  <input id="dob" type="date">
  <input id="station" placeholder="Station">
  <input id="therapeut" placeholder="Therapeut">
  <input id="datum" type="date">
</div>
</div>

<!-- B -->
<div class="card plan">
<h2>B. Therapieplanung</h2>
<div class="grid">
  <input id="diagnose" placeholder="Diagnose">
  <textarea id="icf" placeholder="ICF-Ziele"></textarea>
  <select id="phase">
    <option value="">Rehaphase</option>
    <option>Akut</option>
    <option>Aufbau</option>
    <option>Funktionell</option>
    <option>Return-to-Activity</option>
  </select>
  <input id="schmerz" placeholder="Max. Schmerz (NRS)">
</div>
</div>

<!-- C -->
<div class="card exec">
<h2 onclick="toggleExercises()" style="cursor:pointer">
C. Ger√§te & √úbungen ‚¨á
</h2>

<div id="exerciseContent" class="table-wrap">
<table id="exerciseTable">
<tr>
  <th>‚úî</th><th>Nr</th><th>Art</th><th>Ger√§t</th>
  <th>Watt</th><th>kg</th><th>S√§tze</th>
  <th>Wdh</th><th>UPM</th><th>Pause</th><th>Kommentar</th>
</tr>
</table>
</div>
</div>

<!-- D -->
<div class="card eval">
<h2>D. Evaluation</h2>
<div class="grid">
  <select id="evalROM">
    <option value="">ROM erreicht?</option>
    <option>Ja</option><option>Teilweise</option><option>Nein</option>
  </select>
  <textarea id="evalNote" placeholder="Verlauf / Evaluation"></textarea>
</div>
</div>

<footer>MTT-Planer ¬∑ Single-HTML ¬∑ Klinikstandard</footer>
</div>

<script>
/* Ger√§te */
const geraete=[
"Laufband","Fahrradergometer","Arm-Ergometer","Ellipsentrainer","Stepper",
"Ruderergometer","Beinpresse","Beinstrecker","Beinbeuger","Adduktor","Abduktor",
"Latzug","Ruderzug","Butterfly","Chest Press","Shoulder Press","Seilzug",
"Rumpfstrecker","Rumpfbeuger","Rotationstrainer","H√ºftstrecker","H√ºftbeuger",
"Kabelzug","Zirkelstation Beine","Zirkelstation Arme","Zirkelstation Rumpf",
"Koordinationsleiter","Balance Board","TheraBand","Freihanteln","Kettlebell",
"Medizinball","Handkurbel","Crosstrainer","Step Board","Sling Trainer",
"Power Plate","Schlingentisch","Sprossenwand","Therapiekreisel","Bosu Ball",
"Trampolin","Isokinetik","Air Bike","Ergometer","Gangtrainer","Treppentrainer",
"Stehtrainer","Rollstuhltrainer","Core Trainer","Wall Pulley"
];

/* Presets */
const presets={
  Kraft:{s:"3",w:"10",u:"",g:"10",wa:""},
  Ausdauer:{s:"1",w:"",u:"60",g:"",wa:"100"},
  Mobilit√§t:{s:"2",w:"12",u:"",g:"",wa:""},
  Stabilisation:{s:"2",w:"12",u:"",g:"",wa:""}
};

const table=document.getElementById("exerciseTable");

/* Build 70 rows */
for(let i=1;i<=70;i++){
  const r=table.insertRow();
  r.innerHTML=`
<td><input type="checkbox"></td>
<td>${i}</td>
<td>
<select onchange="applyPreset(this)">
<option value="">‚Äì</option>
<option>Kraft</option>
<option>Ausdauer</option>
<option>Mobilit√§t</option>
<option>Stabilisation</option>
</select>
</td>
<td><select><option value="">Ger√§t</option>${geraete.map(g=>`<option>${g}</option>`).join("")}</select></td>
<td><input></td><td><input></td><td><input></td>
<td><input></td><td><input></td><td><input></td><td><input></td>`;
}

/* Preset */
function applyPreset(sel){
  const p=presets[sel.value]; if(!p) return;
  const i=sel.closest("tr").querySelectorAll("input,select");
  i[6].value=p.s; i[7].value=p.w; i[8].value=p.u;
  i[5].value=p.g; i[4].value=p.wa;
}

/* Collapse */
function toggleExercises(){
  const el=document.getElementById("exerciseContent");
  el.style.display = el.style.display==="none" ? "block" : "none";
}

/* Print FIX */
function preparePrint(){
  document.querySelectorAll("input,select,textarea").forEach(el=>{
    if(el.type==="checkbox") return;
    let s=el.parentElement.querySelector(".print-value");
    if(!s){ s=document.createElement("div"); s.className="print-value"; el.parentElement.appendChild(s); }
    s.textContent=el.value || "‚Äî";
  });

  [...table.rows].forEach((r,i)=>{
    if(i===0){ r.classList.add("printable"); return; }
    const cb=r.querySelector("input[type=checkbox]");
    const meaningful=[...r.querySelectorAll("input,select")]
      .filter(e=>e.type!=="checkbox")
      .some(e=>e.value && e.value!=="");
    if(cb.checked || meaningful) r.classList.add("printable");
    else r.classList.remove("printable");
  });
}
function quickPrint(){ preparePrint(); window.print(); }

/* Save / Load */
function savePatient(){
  const data={};
  document.querySelectorAll("input,select,textarea").forEach(e=>{ if(e.id) data[e.id]=e.value; });
  data.ex=[...table.rows].slice(1).map(r=>
    [...r.querySelectorAll("input,select")].map(e=>e.type==="checkbox"?e.checked:e.value)
  );
  localStorage.setItem("MTT_"+pid.value,JSON.stringify(data));
  alert("Gespeichert");
}
function loadPatient(){
  const d=JSON.parse(localStorage.getItem("MTT_"+pid.value));
  if(!d) return alert("Nicht gefunden");
  document.querySelectorAll("input,select,textarea").forEach(e=>{ if(e.id&&d[e.id]) e.value=d[e.id]; });
  d.ex.forEach((row,i)=>{
    const c=[...table.rows[i+1].querySelectorAll("input,select")];
    row.forEach((v,j)=>c[j].type==="checkbox"?c[j].checked=v:c[j].value=v);
  });
}
function deletePatient(){
  localStorage.removeItem("MTT_"+pid.value);
  alert("Gel√∂scht");
}
</script>
</body>
</html>
