<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MTT Therapieplan</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  background:#f3f4f6;margin:0;padding:12px;color:#111827
}
h1,h2{margin:0 0 8px}
.container{max-width:1000px;margin:auto}
.card{
  background:#fff;border-radius:12px;padding:12px;margin-bottom:12px;
  box-shadow:0 2px 10px rgba(0,0,0,.08)
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:8px
}
input,select,textarea{
  width:100%;padding:8px;border-radius:6px;
  border:1px solid #cbd5e1;font-size:.85rem
}
textarea{resize:vertical}
.actions{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
button{
  padding:10px;border-radius:8px;border:none;
  background:#0284c7;color:#fff;font-size:.85rem;cursor:pointer
}
button.secondary{background:#334155}
button.warn{background:#dc2626}

.admin{border-left:4px solid #ca8a04}
.plan{border-left:4px solid #0284c7}
.exec{border-left:4px solid #16a34a}
.eval{border-left:4px solid #ea580c}

.table-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:.75rem;min-width:1100px}
th{background:#0284c7;color:#fff;padding:6px}
td{border-bottom:1px solid #e5e7eb;padding:6px;text-align:center}

.print-value{display:none;font-size:12px}

@media print{
  .actions,button{display:none}
  input,select,textarea{display:none}
  .print-value{display:inline}
  #exerciseTable tr{display:none}
  #exerciseTable tr.printable{display:table-row}
}

footer{text-align:center;font-size:.7rem;color:#6b7280;margin-top:16px}
</style>
</head>

<body>
<div class="container">

<h1>MTT-Therapieplan</h1>
<div style="font-size:.75rem;color:#475569;margin-bottom:10px">
Offline ¬∑ Druckf√§hig ¬∑ Patientenspezifisch
</div>

<div class="actions">
  <button onclick="savePatient()">üíæ Speichern</button>
  <button class="secondary" onclick="loadPatient()">üìÇ Laden</button>
  <button class="warn" onclick="deletePatient()">üóëÔ∏è L√∂schen</button>
  <button onclick="quickPrint()">üñ®Ô∏è Patient-PDF</button>
</div>

<!-- A ADMIN -->
<div class="card admin">
<h2>A. Patient & Organisation</h2>
<div class="grid">
  <input id="pid" placeholder="Patienten-ID">
  <input id="name" placeholder="Name">
  <input id="dob" type="date">
  <input id="station" placeholder="Station">
  <input id="therapeut" placeholder="Therapeut">
  <input id="datum" type="date">
</div>
</div>

<!-- B PLAN -->
<div class="card plan">
<h2>B. Therapieplanung</h2>
<div class="grid">
  <input id="diagnose" placeholder="Diagnose">
  <textarea id="icf" placeholder="ICF-Ziele"></textarea>
  <select id="phase">
    <option>Akut</option><option>Aufbau</option>
    <option>Funktionell</option><option>Return-to-Activity</option>
  </select>
  <input id="schmerz" placeholder="Max. Schmerz (NRS)">
</div>
</div>

<!-- C EXERCISES -->
<div class="card exec">
<h2 onclick="toggleExercises()" style="cursor:pointer">
C. Ger√§te & √úbungen ‚¨á
</h2>

<div id="exerciseContent" class="table-wrap">
<table id="exerciseTable">
<tr>
  <th>‚úî</th><th>Nr</th><th>Art</th><th>Ger√§t</th>
  <th>Intensit√§t</th><th>S√§tze</th><th>Wdh/Min</th>
  <th>Pause</th><th>Kommentar</th>
</tr>
</table>
</div>
</div>

<!-- D EVAL -->
<div class="card eval">
<h2>D. Evaluation</h2>
<div class="grid">
  <select id="evalROM">
    <option>ROM erreicht?</option>
    <option>Ja</option><option>Teilweise</option><option>Nein</option>
  </select>
  <textarea id="evalNote" placeholder="Evaluation / Verlauf"></textarea>
</div>
</div>

<footer>MTT-Planer ¬∑ Single-HTML ¬∑ Klinikstandard</footer>
</div>

<script>
const geraete=[
"Laufband","Fahrradergometer","Arm-Ergometer","Ellipsentrainer",
"Stepper","Ruderergometer","Beinpresse","Beinstrecker","Beinbeuger",
"Adduktor","Abduktor","Latzug","Ruderzug","Butterfly","Butterfly Reverse",
"Chest Press","Shoulder Press","Seilzug","Rumpfstrecker","Rumpfbeuger",
"Rotationstrainer","H√ºftstrecker","H√ºftbeuger","Kniebeuge","Smith Machine",
"Multipresse","Kabelzug","Zirkelstation 1","Zirkelstation 2","Zirkelstation 3",
"Koordinationsleiter","Balance Board","TheraBand","Freihanteln",
"Kettlebell","Medizinball","Handkurbel","Oberk√∂rperergometer",
"Unterk√∂rperergometer","Crosstrainer","Step Board","Slackline",
"Vibrationstrainer","Sling Trainer","Power Plate","Kletterwand",
"Pedaltrainer","Rollbrett","Therapiekreisel","Bosu Ball",
"Trampolin","Isokinetik","Ergoometer","Air Bike",
"Sprossenwand","Schlingentisch","Wall Pulley"
];

const table=document.getElementById("exerciseTable");

/* build 70 rows */
for(let i=1;i<=70;i++){
  const r=table.insertRow();
  r.innerHTML=`
<td><input type="checkbox"></td>
<td>${i}</td>
<td>
<select>
<option>Kraft</option>
<option>Ausdauer</option>
<option>Mobilit√§t</option>
<option>Stabilisation</option>
</select>
</td>
<td><select>${geraete.map(g=>`<option>${g}</option>`).join("")}</select></td>
<td><input></td>
<td><input></td>
<td><input></td>
<td><input></td>
<td><input></td>`;
}

/* collapsible */
function toggleExercises(){
  const el=document.getElementById("exerciseContent");
  el.style.display = el.style.display==="none" ? "block" : "none";
}

/* save/load */
function savePatient(){
  const data={};
  document.querySelectorAll("input,select,textarea").forEach(e=>{
    if(e.id) data[e.id]=e.value;
  });
  data.exercises=[...table.rows].slice(1).map(r=>
    [...r.querySelectorAll("input,select")].map(e=>e.type==="checkbox"?e.checked:e.value)
  );
  localStorage.setItem("MTT_"+pid.value,JSON.stringify(data));
  alert("Gespeichert");
}

function loadPatient(){
  const d=JSON.parse(localStorage.getItem("MTT_"+pid.value));
  if(!d)return alert("Nicht gefunden");
  document.querySelectorAll("input,select,textarea").forEach(e=>{
    if(e.id&&d[e.id]!==undefined) e.value=d[e.id];
  });
  d.exercises.forEach((row,i)=>{
    const cells=[...table.rows[i+1].querySelectorAll("input,select")];
    row.forEach((v,j)=>cells[j].type==="checkbox"?cells[j].checked=v:cells[j].value=v);
  });
}

function deletePatient(){
  localStorage.removeItem("MTT_"+pid.value);
  alert("Gel√∂scht");
}

/* print fix */
function preparePrint(){
  document.querySelectorAll("input,select,textarea").forEach(el=>{
    let s=el.parentElement.querySelector(".print-value");
    if(!s){s=document.createElement("span");s.className="print-value";el.parentElement.appendChild(s);}
    s.textContent=el.value||"";
  });
  [...table.rows].forEach((r,i)=>{
    if(i===0){r.classList.add("printable");return;}
    const cb=r.querySelector("input[type=checkbox]");
    const filled=[...r.querySelectorAll("input,select")].some(e=>e.value);
    if(cb.checked||filled) r.classList.add("printable");
    else r.classList.remove("printable");
  });
}
function quickPrint(){preparePrint();window.print();}
</script>
</body>
</html>
